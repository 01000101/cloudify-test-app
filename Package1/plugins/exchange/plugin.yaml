tosca_definitions_version: cloudify_dsl_1_1

plugins:
  exchange_facilitator:
    executor: central_deployment_agent
    source: exchange
  exchange_agent:
    executor: host_agent
    source: exchange
  
imports:
  - http://www.getcloudify.org/spec/cloudify/3.2.1/types.yaml
  
node_types:
  exchange.nodes.Facilitator:
    derived_from: cloudify.nodes.Root
    properties:
      exchange_tmp_priv_key_path:
        default: keys/temp.key
        description: >
          Relative path (from blueprint) to the temporary private key to SSH between app servers
      exchange_key_path:
        default: /tmp/exchange/poc.key
        description: >
          Absolute path to where the keys will be generated / retrieved (creates file + file.pub)
      exchange_ssh_user:
        default: ubuntu
        description: >
          User to use for SSH'ing to servers (may be separate from the user the Cloudify manager uses for SSH)
      exchange_ssh_authorized_keys_path:
        default: /home/ubuntu/.ssh/authorized_keys
        description: >
          Absolute path to the "authorized_keys" file used to allow SSH clients to connect based on public keys
    interfaces:
      cloudify.interfaces.lifecycle:
        configure:
          implementation: exchange_facilitator.plugin.tasks.configure
          
  exchange.nodes.Agent:
    derived_from: cloudify.nodes.Root
    properties:
      exchange_tmp_pub_key_path:
        default: keys/temp.key.pub
        description: >
          Relative path (from blueprint) to the temporary public key to allow SSH into app servers
      exchange_key_path:
        default: /tmp/exchange/poc.key
        description: >
          Absolute path to where the keys will be generated / retrieved (creates file + file.pub)
    interfaces:
      cloudify.interfaces.lifecycle:
        configure:
          implementation: exchange_agent.plugin.tasks.install_linux_agent
          